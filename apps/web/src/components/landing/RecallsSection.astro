---
/**
 * RecallsSection.astro
 * Full recalls section with recall cards and email capture for alerts
 *
 * Props:
 * - recalls: Recall[] - Array of recalls to display
 * - state: string - State name for contextual messaging
 */

import type { Recall } from '@/types/recalls';
import RecallCard from './RecallCard.astro';
import MicroEmailCapture from './MicroEmailCapture.astro';

interface Props {
  recalls: Recall[];
  state: string;
}

const { recalls, state } = Astro.props;

// Check if there are any recalls
const hasRecalls = recalls && recalls.length > 0;
---

<section class="section-padding bg-white">
  <div class="container-wide">
    <!-- Section Header -->
    <div class="mb-8">
      <h2 class="text-2xl md:text-3xl font-bold text-slate-900 mb-3">
        Active Food Recalls
      </h2>
      <p class="text-lg text-slate-600">
        Stay informed about food safety recalls that may affect your operation.
      </p>
    </div>

    {hasRecalls ? (
      <>
        <!-- Recall Cards Grid -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
          {recalls.map((recall) => (
            <RecallCard recall={recall} />
          ))}
        </div>
      </>
    ) : (
      <!-- No Recalls Message -->
      <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8">
        <div class="flex items-center gap-3">
          <span class="text-2xl" aria-hidden="true">{'\u2705'}</span>
          <div>
            <h3 class="font-semibold text-green-900">No Active Recalls</h3>
            <p class="text-green-700">
              No active recalls currently affecting {state} food service.
            </p>
          </div>
        </div>
      </div>
    )}

    <!-- Email Alert Signup -->
    <div class="mb-8">
      <MicroEmailCapture
        headline="Get Instant Recall Alerts"
        subtext="Be the first to know when recalls affect your area. We monitor FDA and USDA announcements daily."
        buttonText="Subscribe"
        source="recalls"
      />
    </div>

    <!-- Sources Footer -->
    <div class="text-center">
      <p class="text-sm text-slate-500">
        Sources: <a href="https://www.fda.gov/safety/recalls-market-withdrawals-safety-alerts" target="_blank" rel="noopener noreferrer" class="text-primary-600 hover:text-primary-700 underline">FDA.gov</a>, <a href="https://www.fsis.usda.gov/recalls" target="_blank" rel="noopener noreferrer" class="text-primary-600 hover:text-primary-700 underline">USDA FSIS</a>. Updated automatically.
      </p>
    </div>
  </div>
</section>
