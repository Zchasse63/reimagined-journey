---
/**
 * RecallCard.astro
 * Individual recall display card with classification-based styling
 *
 * Props:
 * - recall: Recall - The recall data to display
 */

import type { Recall, RecallClassification } from '@/types/recalls';

interface Props {
  recall: Recall;
}

const { recall } = Astro.props;

// Classification-based styling
const getClassificationStyles = (classification: RecallClassification) => {
  switch (classification) {
    case 'Class I':
      return {
        badge: 'bg-red-100 text-red-800',
        border: 'border-l-red-500',
        icon: '\u{1F534}', // red circle
        label: 'HIGH RISK',
      };
    case 'Class II':
      return {
        badge: 'bg-amber-100 text-amber-800',
        border: 'border-l-amber-500',
        icon: '\u{1F7E0}', // orange circle
        label: 'MODERATE RISK',
      };
    case 'Class III':
    default:
      return {
        badge: 'bg-gray-100 text-gray-800',
        border: 'border-l-gray-400',
        icon: '\u26AA', // white circle
        label: 'LOW RISK',
      };
  }
};

const styles = getClassificationStyles(recall.classification);

// Format date for display
const formatDate = (dateString: string) => {
  try {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    });
  } catch {
    return dateString;
  }
};

// Truncate long text
const truncate = (text: string, maxLength: number) => {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength).trim() + '...';
};
---

<div
  class={`bg-white rounded-lg shadow-md border-l-4 ${styles.border} p-5 hover:shadow-lg transition-shadow`}
>
  <!-- Header: Classification badge and date -->
  <div class="flex items-center justify-between mb-3">
    <span class={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold ${styles.badge}`}>
      <span aria-hidden="true">{styles.icon}</span>
      {recall.classification} - {styles.label}
    </span>
    <span class="text-sm text-slate-500">
      {formatDate(recall.recall_initiation_date)}
    </span>
  </div>

  <!-- Recalling firm / title -->
  <h3 class="text-lg font-semibold text-slate-900 mb-2">
    {recall.recalling_firm}
  </h3>

  <!-- Reason for recall -->
  <div class="mb-2">
    <span class="text-sm font-medium text-slate-700">Reason: </span>
    <span class="text-sm text-slate-600">
      {truncate(recall.reason_for_recall, 150)}
    </span>
  </div>

  <!-- Products affected -->
  <div class="mb-2">
    <span class="text-sm font-medium text-slate-700">Products: </span>
    <span class="text-sm text-slate-600">
      {truncate(recall.product_description, 100)}
    </span>
  </div>

  <!-- Distribution pattern -->
  <div class="mb-4">
    <span class="text-sm font-medium text-slate-700">Distribution: </span>
    <span class="text-sm text-slate-600">
      {truncate(recall.distribution_pattern, 80)}
    </span>
  </div>

  <!-- Link to FDA notice -->
  <a
    href={recall.url}
    target="_blank"
    rel="noopener noreferrer"
    class="inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors"
  >
    View Full FDA Notice
    <span class="ml-1" aria-hidden="true">{'\u2192'}</span>
  </a>
</div>
